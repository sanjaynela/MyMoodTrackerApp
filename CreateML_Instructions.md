# Creating a Core ML Model with Create ML

## Step-by-Step Instructions

### 1. Prepare Training Data
First, create a CSV file with your training data. You can use the sample data generated by the Python script or create your own:

```csv
sleep_hours,steps,screen_time,mood
7.5,8000,3.0,Happy
6.0,5000,5.0,Neutral
5.0,3000,8.0,Sad
8.0,12000,2.0,Happy
7.0,6000,4.0,Neutral
```

### 2. Create ML Model in Xcode
1. Open Xcode
2. Go to **File > New > File**
3. Select **Create ML Model** under the **Core ML** section
4. Choose **Classifier** as the model type
5. Click **Next**

### 3. Configure the Model
1. **Name**: `MoodPredictor`
2. **Description**: "Mood prediction based on sleep, steps, and screen time"
3. **Author**: Your name
4. **License**: MIT
5. Click **Next**

### 4. Import Training Data
1. Click **Choose Files** and select your CSV file
2. **Target Column**: Select `mood` (this is what we want to predict)
3. **Feature Columns**: Select `sleep_hours`, `steps`, `screen_time`
4. Click **Next**

### 5. Configure Training
1. **Algorithm**: Choose **Random Forest** (good for this type of data)
2. **Validation**: Leave as default (20% for testing)
3. **Max Iterations**: 100 (or adjust as needed)
4. Click **Next**

### 6. Train the Model
1. Click **Train** to start the training process
2. Wait for training to complete
3. Review the training results and accuracy metrics
4. Click **Next**

### 7. Save the Model
1. Choose a location to save your `.mlmodel` file
2. Name it `MoodPredictor.mlmodel`
3. Click **Save**

### 8. Add to Xcode Project
1. Drag the `MoodPredictor.mlmodel` file into your Xcode project
2. Make sure "Copy items if needed" is checked
3. Add to your target

### 9. Update the Code
Replace the heuristic logic in `MoodPredictorCoreML.swift` with the actual Core ML implementation:

```swift
import CoreML

class MoodPredictorCoreML {
    private var model: MoodPredictor?
    
    init() {
        do {
            let config = MLModelConfiguration()
            model = try MoodPredictor(configuration: config)
        } catch {
            print("Failed to load Core ML model: \(error)")
        }
    }
    
    func predictMood(sleepHours: Double, steps: Int, screenTime: Double) -> (MoodType, Double) {
        guard let model = model else {
            return (.neutral, 0.0)
        }
        
        do {
            let input = MoodPredictorInput(
                sleep_hours: sleepHours,
                steps: Double(steps),
                screen_time: screenTime
            )
            
            let prediction = try model.prediction(input: input)
            
            let moodType: MoodType
            switch prediction.mood {
            case "Happy": moodType = .happy
            case "Neutral": moodType = .neutral
            case "Sad": moodType = .sad
            default: moodType = .neutral
            }
            
            let confidence = prediction.confidence[prediction.mood] ?? 0.0
            
            return (moodType, confidence)
        } catch {
            print("Prediction failed: \(error)")
            return (.neutral, 0.0)
        }
    }
}
```

## Sample Training Data
Here's a larger sample dataset you can use for training:

```csv
sleep_hours,steps,screen_time,mood
8.0,10000,2.0,Happy
7.5,8000,3.0,Happy
7.0,6000,4.0,Neutral
6.5,5000,5.0,Neutral
6.0,4000,6.0,Neutral
5.5,3000,7.0,Sad
5.0,2000,8.0,Sad
4.5,1500,9.0,Sad
8.5,12000,1.5,Happy
7.8,9000,2.5,Happy
7.2,7000,3.5,Neutral
6.8,5500,4.5,Neutral
6.2,3500,5.5,Neutral
5.8,2500,6.5,Sad
5.2,1800,7.5,Sad
4.8,1200,8.5,Sad
```

## Tips for Better Results
1. **More Data**: The more training examples, the better the model
2. **Balanced Classes**: Try to have equal numbers of each mood type
3. **Realistic Data**: Use realistic ranges for sleep, steps, and screen time
4. **Feature Engineering**: Consider adding derived features like sleep quality score
5. **Validation**: Test the model with different inputs to ensure it works as expected

## Testing the Model
After adding the model to your project, test it with various inputs:

```swift
let predictor = MoodPredictorCoreML()

// Test cases
let testCases = [
    (8.0, 10000, 2.0), // Should predict Happy
    (5.0, 3000, 8.0),  // Should predict Sad
    (7.0, 6000, 4.0),  // Should predict Neutral
]

for (sleep, steps, screen) in testCases {
    let (mood, confidence) = predictor.predictMood(
        sleepHours: sleep,
        steps: steps,
        screenTime: screen
    )
    print("Sleep: \(sleep)h, Steps: \(steps), Screen: \(screen)h â†’ \(mood) (\(Int(confidence * 100))%)")
}
```

This will give you a fully functional Core ML model integrated into your mood tracker app! 